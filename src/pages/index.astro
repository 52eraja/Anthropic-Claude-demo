---
import Layout from '../layouts/Layout.astro'
import Header from '../components/Header.astro'
import Footer from '../components/Footer.astro'
import Generator from '../components/Generator'

import '../message.css'
import 'katex/dist/katex.min.css'
import 'highlight.js/styles/atom-one-dark.css'

// Fetch the SITE_PASSWORD from env during the server-side rendering phase
const { SITE_PASSWORD } = Astro.props;
---

<Layout title="Anthropic API Demo">
  <main>
    <Header />
    <Generator client:load />
    <Footer />
  </main>
</Layout>


<script>
    const SITE_PASSWORD = Astro?.publicRuntimeConfig?.SITE_PASSWORD || '';

    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
      }

    async function checkCurrentAuth() {
      const password = getCookie('pass')

      const response = await fetch('/api/auth', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          pass: password,
        }),
      })

      const responseJson = await response.json()

      if (responseJson.code !== 0)
        window.location.href = '/password'
    }

    // Only call checkCurrentAuth if SITE_PASSWORD is set
    if (SITE_PASSWORD) {
    checkCurrentAuth();
    }
</script>